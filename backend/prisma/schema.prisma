generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  STUDENT
  LAB_INCHARGE
  ADMIN
  HOD
}

enum ResourceOwnerType {
  LAB
  DEPARTMENT
}

enum Department {
  ELECTRICAL_ENGG
  MECHANICAL_ENGG
  FOOTWEAR_ENGG
  CIVIL_ENGG
  AGRICULTURE_ENGG
  SCIENCE
  ARTS
  COMMERCE
  AYUSH
  ELECTRICAL_TECHNICAL
  AUTOMOBILE_TECHNICAL
  ENGLISH
  OTHER
}

enum TicketStatus {
  PENDING
  REJECTED
  ACCEPTED
  RETURNED
  OVERDUE
  ALLOCATED
}

enum UnitStatus {
  AVAILABLE
  IN_USE
  MAINTENANCE
  RETIRED
}

model User {
  id               String     @id @default(cuid())
  email            String     @unique
  name             String
  rollNumber       String?     @unique
  enrollmentNumber String?     @unique
  department       Department
  role             Role
  profilePhoto     String?
  password         String
  
  tickets          Ticket[]   
  
  createdAt        DateTime   @default(now())
  updatedAt        DateTime   @updatedAt
}


model ResourceCategory {
  id          String     @id @default(cuid())
  name        String    
  description String?
  resources   Resource[]
  
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
}


model Resource {
  id                String           @id @default(cuid())
  name              String           
  model             String?          
  manufacturer      String?          
  description       String?
  
  categoryId        String
  category          ResourceCategory @relation(fields: [categoryId], references: [id])
  
  department        Department       
  ownerType         ResourceOwnerType
  location          String?          
  
  totalQuantity     Int
  availableQuantity Int
  
  units             ResourceUnit[]   
  tickets           Ticket[]         
  
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  
  @@index([categoryId])
  @@index([department])
  @@unique([department, categoryId, name]) 
}


model ResourceUnit {
  id           String     @id @default(cuid())
  serialNumber String?    @unique
  status       UnitStatus @default(AVAILABLE)
  condition    String?    
  notes        String?
  
  resourceId   String
  resource     Resource   @relation(fields: [resourceId], references: [id], onDelete: Cascade)
  
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  
  @@index([resourceId])
  @@index([status])
}

model Ticket {
  id          String       @id @default(cuid())
  
  userId      String
  user        User         @relation(fields: [userId], references: [id])
  
  resourceId  String
  resource    Resource     @relation(fields: [resourceId], references: [id])
  
  quantity    Int          @default(1)
  status      TicketStatus @default(PENDING)
  
  requestDate DateTime     @default(now())
  fromDate    DateTime     // When user needs the resource
  toDate      DateTime     // When user will return
  
  purpose     String?      // Why they need it
  
  approvedBy  String?      // Lab incharge/admin who approved
  approvedAt  DateTime?
  
  allocatedAt DateTime?    // When resource was actually given
  returnedAt  DateTime?    // When resource was returned
  
  remarks     String?      // Any notes from admin
  
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  
  @@index([userId])
  @@index([resourceId])
  @@index([status])
}