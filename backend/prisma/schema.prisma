generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  STUDENT
  LAB_INCHARGE
  ADMIN
  HOD
}

enum Department {
  ELECTRICAL_ENGG
  MECHANICAL_ENGG
  FOOTWEAR_ENGG
  CIVIL_ENGG
  AGRICULTURE_ENGG
  SCIENCE
  ARTS
  COMMERCE
  AYUSH
  ELECTRICAL_TECHNICAL
  AUTOMOBILE_TECHNICAL
  ENGLISH
  OTHER
}

enum ResourceStatus {
  AVAILABLE
  OCCUPIED
  LOST
  UNDER_MAINTENANCE
}

enum ResourceRequestStatus {
  ACCEPTED
  REJECTED
  PENDING
}

model User {
  id               String             @id @default(cuid())
  email            String             @unique
  name             String
  rollNumber       String?            @unique
  enrollmentNumber String?            @unique
  department       Department
  role             Role
  profilePhoto     String?
  password         String
  authority        ResourceAuthority?


  resourcesRequested  ResourceRequest[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ResourceAuthority {
  id          String     @id @default(cuid())
  name        String
  department  Department
  location    String
  description String?

  ownerId String @unique
  ownedBy User   @relation(fields: [ownerId], references: [id])

  resourceCategories ResourceCategory[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ResourceCategory {
  id          String  @id @default(cuid())
  name        String
  description String?

  authorityId       String
  resourceAuthority ResourceAuthority @relation(fields: [authorityId], references: [id])

  isActive Boolean @default(true)

  resources Resource[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([name, authorityId])
}

model Resource {
  id          String  @id @default(cuid())
  name        String
  description String?
  model       String?

  resourceCategoryId String
  resourceCategory   ResourceCategory @relation(fields: [resourceCategoryId], references: [id])

  isActive Boolean @default(true)
  quantity Int     @default(1)

  status           ResourceStatus @default(AVAILABLE)
  resourceRequests ResourceRequest[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ResourceRequest {
  id         String   @id @default(cuid())
  resourceId String
  resource   Resource @relation(fields: [resourceId], references: [id])
  quantity   Int

  ticketId    String
  ticket      Ticket @relation(fields: [ticketId], references: [id])

  userId String
  user   User @relation(fields: [userId], references: [id])

  from DateTime
  till DateTime

  status ResourceRequestStatus

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Ticket {
  id         String @id @default(cuid())
  issuedBy   String
  userId     String

  resourcesRequested ResourceRequest[]

  isActive  Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

}
